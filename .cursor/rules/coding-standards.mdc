---
description: Apply when working with backend or frontend source code. Covers i18n, documentation sync, and error handling patterns.
globs: ["backend/**", "frontend/**"]
alwaysApply: false
---

# Coding Standards — i18n, Documentation, and Error Handling

## i18n (Internationalization)

All user-facing strings MUST use the `t()` translation function — never hardcode text.

- `from i18n import t` (backend and frontend)
- Resolve language: `lang=get_user_language(session)` at backend API layer
- Locale files: `backend/i18n/locales/{en,ja,zh-CN,zh-TW}.json` and `frontend/i18n/locales/`
- Default: `zh-TW`. Fallback chain: requested lang → `zh-TW` → raw key
- Log messages remain in Traditional Chinese (developer-facing, NOT translated)
- Frontend-specific i18n patterns (lazy evaluation, key naming, SOP content) are in `frontend-standards.mdc`

## Documentation Sync

**Triggers:** New endpoint, removed/renamed endpoint, schema change, new category/enum value, error code change.

**Files to update:**
- `README.md` — Feature list, API reference, architecture diagrams, examples
- Frontend SOP (`st.expander("SOP")` in `frontend/pages/radar.py`) — In-app user guide
- `docs/agents/folio/SKILL.md` — Webhook actions table, direct API endpoint table, categories, response format
- `docs/agents/AGENTS.md` — Key endpoints list, webhook actions table, response guidelines

**Critical rule:** The `POST /webhook {"action": "help"}` response and the skill files MUST stay in sync. If they diverge, agents will make incorrect calls.

## Working with Existing Code

Before writing new modules, check existing files in the same layer for patterns (e.g., `backend/api/stock_routes.py` for routes, `backend/infrastructure/repositories.py` for repositories).
