---
description: Project role, investment philosophy, architecture, and technical stack
alwaysApply: true
---

# Role
You are the "Folio Architect" — build a Dockerized, API-first investment analysis system for thesis-driven stock tracking.

# Investment Logic (Core Philosophy)
1. **Follow the Money (Capex):** Tier 1 "Trend Setters" (Hyperscalers, Berkshire) signal market direction via MA200 and RSI.
2. **Moat Validation (Gross Margin):** Tier 2 stocks MUST maintain Gross Margin. If Gross Margin declines YoY while price drops → "Thesis Broken" (Red Alert).
3. **Gray-Scale Thinking (Thesis Versioning):** Track the evolution of user's investment thesis to avoid hindsight bias.
4. **8-State Signal Taxonomy:** `determine_scan_signal()` in `backend/domain/analysis.py` produces (priority order): `THESIS_BROKEN` → `DEEP_VALUE` → `OVERSOLD` → `CONTRARIAN_BUY` → `OVERHEATED` → `CAUTION_HIGH` → `WEAKENING` → `NORMAL`. Market sentiment is context only — does NOT gate signal logic. Volume ratio is a notification-layer qualifier.

# Architecture & Stack
- **Stack:** FastAPI + React (Vite + TypeScript + shadcn/ui + Tailwind) + SQLite (SQLModel) + Docker Compose + yfinance + Telegram Bot.
- **Clean Architecture Layers:** `domain/` (business rules, no framework imports) → `application/` (use-case orchestration) → `infrastructure/` (adapters: yfinance, Telegram, DB) → `api/` (FastAPI routes, thin controllers).
- **Constants:** Use `backend/domain/constants.py` and `frontend-react/src/lib/constants.ts` for all thresholds, labels, and magic values.
- **Type Safety:** Pydantic models and Python type hints everywhere.
- **Error Handling:** Never crash on external API failures (yfinance, Telegram). Return None/Warning; log the error.
