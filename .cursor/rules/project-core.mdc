---
description: Project identity, architecture, and technical stack
alwaysApply: true
---

# Folio — Investment Analysis System

**Role:** Folio Architect — Dockerized, API-first, thesis-driven stock tracking system.

## Stack
FastAPI + React (Vite + TypeScript + shadcn/ui + Tailwind) + SQLite (SQLModel) + Docker Compose + yfinance + Telegram Bot.

## Architecture (Clean Architecture)
`domain/` (`core/`, `analysis/`, `portfolio/`) → `application/` (`stock/`, `scan/`, `portfolio/`, `guru/`, `messaging/`, `settings/`) → `infrastructure/` (`market_data/`, `persistence/`, `external/`) → `api/` (`routes/`, `schemas/`).

Each layer is further grouped into domain-specific sub-packages. Old flat import paths (e.g. `from domain.constants import X`, `from infrastructure.repositories import Y`) are preserved via backward-compat shims so existing code continues to work unchanged.

## Key Conventions
- **Constants:** `backend/domain/core/constants.py` (also accessible as `backend/domain/constants.py` via shim) and `frontend-react/src/lib/constants.ts` for all thresholds, labels, and magic values.
- **Type Safety:** Pydantic models and Python type hints everywhere.
- **API Type Codegen:** Run `make generate-api` after changing any Pydantic schema in `backend/api/schemas/`. The `api/schemas/__init__.py` re-exports all schemas so `from api.schemas import X` keeps working.
- **Dependency Management:** Backend uses pip-tools. Edit `backend/requirements.in` (loose constraints), then run `make lock` to regenerate the pinned `backend/requirements.txt`. Never edit `requirements.txt` by hand.
- **Error Handling:** Never crash on external API failures (yfinance, Telegram). Return None/Warning; log the error.
- **Architecture Boundaries:** See `.cursor/rules/architecture-boundaries.mdc`. API routes in `api/routes/` delegate to `application/<domain>/` services — never import directly from `infrastructure/` (except `infrastructure.database`).
- **New Features:** Follow Research → Plan → Implement → Verify (`make ci`) workflow. Check existing patterns in the same sub-package before writing new code.
- **Documentation Sync:** When adding or changing any feature, update: (1) `README.md` feature list/API reference, (2) in-page instructions (SOP collapsible sections, help tooltips) in affected frontend pages, (3) `docs/agents/folio/SKILL.md` and `docs/agents/AGENTS.md` if endpoints/webhook actions changed, (4) run `make generate-api` if schemas changed.
