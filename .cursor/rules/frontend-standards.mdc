---
description: Apply when working with React frontend code in the frontend-react/ directory. Covers data fetching, state management, i18n, privacy mode, and component patterns.
globs: ["frontend-react/**"]
---

# Frontend Standards (React + TypeScript)

## API Types (OpenAPI Codegen)
- Frontend types are generated from the backend OpenAPI spec. Do NOT manually define types that have a corresponding Pydantic `response_model` schema in the backend.
- Type files in `src/api/types/` are barrel modules: they re-export generated types from `./generated` and define hand-written types only for untyped endpoints (those returning `dict`/`list[dict]`).
- After changing any Pydantic schema in `backend/api/schemas.py`, run `make generate-api` to regenerate.
- `generated.d.ts` is gitignored. It is regenerated automatically by `npm run build` (via `prebuild`) and `npm run dev` (via `predev`).
- Access pattern: `import type { components } from "./generated"` then `type Foo = components["schemas"]["FooModel"]`.

## Data Fetching
- Use TanStack Query for all API calls. Never use raw `fetch` or `axios` directly in components.
- Set appropriate `staleTime` per query (match backend cache TTLs).
- Use `useMutation` for write operations; invalidate related queries on success.
- API client lives in `src/api/client.ts`. Import `apiClient` from there, never import `axios` directly in pages or components.

## State Management
- **Server state:** TanStack Query cache (queries and mutations).
- **Global UI state:** Zustand stores (`usePrivacyMode`, `useTheme`).
- **Local UI state:** `useState` for form inputs, toggles, and component-specific state.
- Avoid prop-drilling more than 2 levels — use context or Zustand for shared state.

## Configuration
- All constants in `src/lib/constants.ts`. No magic strings in components.
- Never redeclare constant arrays (currencies, categories, markets) inline in components — always import from constants.

## i18n
- All user-facing strings use `useTranslation()` hook and `t("key")`. Never hardcode display text.
- Locale files: `public/locales/{en,ja,zh-CN,zh-TW}.json`.
- Key naming: dot-notation by page/component (e.g., `radar.add_stock`, `common.refresh`).
- String interpolation: Use i18next `{{variable}}` syntax in locale values, then `t("key", { variable: value })`.
- SOP content: stored as a single markdown string per locale (e.g., `radar.sop.content`).

## Privacy Mode
- Use `usePrivacyMode()` Zustand hook for privacy state.
- Monetary values: pass `privacyMode` boolean as prop, use `privacyMode ? "***" : formatted_value`.
- Backend-generated advice strings with embedded amounts: render as-is (backend does not embed raw numbers in advice text).

## Dark Mode
- Use `useTheme()` Zustand hook — persisted to `localStorage` as `folio-theme`.
- All Tailwind dark-mode variants (`dark:`) are supported via `.dark` class on `<html>`.
- Plotly charts: use `usePlotlyTheme()` hook for layout overrides (`paper_bgcolor`, `plot_bgcolor`, `font.color`).

## Components
- Use shadcn/ui components as base (Button, Card, Tabs, Sheet, Dialog, etc.).
- Skeleton loading: wrap data sections with `<Skeleton>` while `isLoading`.
- Tables: always wrap `<table>` in `<div className="overflow-x-auto">` for mobile.
- Toast feedback: use `toast.success()` / `toast.error()` from `sonner` on mutation success/error.
- Error boundaries: all pages are wrapped in `<ErrorBoundary>` via `PageShell`.
- Empty states: use `<EmptyState>` component when API returns empty arrays.

## Styling
- Tailwind CSS utility classes. No inline styles except for Plotly chart `layout` objects.
- Dark mode: use `dark:` Tailwind variants.
- Responsive: use `sm:`, `md:`, `lg:` prefixes. Grids that are 3+ columns on desktop must stack on mobile (e.g., `grid-cols-1 sm:grid-cols-3`).
