---
description: Apply when designing or implementing FastAPI backend APIs, webhooks, or agent-facing endpoints. Covers structured responses, OpenAPI completeness, error codes, and webhook discoverability.
globs: ["backend/api/**"]
---

# AI Agent-Friendly API Design

APIs must be discoverable and parseable by AI agents (LLM tool-use, MCP clients) without human help. See `backend/api/stock_routes.py` for the canonical pattern.

## Response Standards
- Every endpoint: JSON with typed Pydantic `response_model`. Exception: `GET /summary` returns plain text.
- Webhook responses: `{"success": bool, "message": str, "data": dict}`.
- Errors: JSON with `error_code` (machine-readable slug) + `detail` (i18n localized). Agents branch on `error_code`.

## OpenAPI Completeness
Every FastAPI route MUST have: `summary` param, typed `response_model`, Pydantic request body schemas for POST/PUT/PATCH.

## Webhook Discoverability
- `POST /webhook {"action": "help"}` returns all supported actions, params, and descriptions.
- Action registry: single source of truth in `backend/domain/constants.py`. New action = one dict entry + one handler.

## Defaults
- List endpoints: `limit=50, offset=0` for pagination.
